=== 게임 진행 로직

image::./images/game_logic.png[]

==== 소켓 통신
websocket + STOMP 프로토콜을 사용해 소켓 통신을 진행합니다.

http -> ws, https -> wss 로 생각해주시면 됩니다.

개발서버는 https를 사용할 것이기 때문에 wss로 연결해주시면 됩니다.

===== Request
[source,json,options="nowrap"]
----
{
  "command": "START",
  "data": "string"
}
----

|===
|Path|Type|Description

|`+command+`
|`+String+`
|요청 구분용 커맨드

|`+data+`
|`+String+`
|String 으로 변환된 json

|===

===== Response
[source,json,options="nowrap"]
----
{
  "command": "START",
  "statusCode": 200,
  "code": "COOK01",
  "data": "JSON"
}
----

|===
|Path|Type|Description

|`+isSuccess+`
|`+Boolean+`
|요청 성공 여부

|`+command+`
|`+String+`
|요청 구분용 커맨드

|`+data+`
|`+String+`
|String으로 변환된 json

|`+statusCode+`
|`+Number+`
|200
|statusCode

|`+code+`
|`+String+`
|COOK01
|요청 결과 코드

|`+data+`
|`+JSON+`
|

|===

data 예시들은 JSON 그대로 표시되어있습니다. 실제 요청시에는 String 으로 변환해주시길 바랍니다.

===== 연결 테스트
포스트맨 기준으로 설명드리겠습니다.

먼저 연결 순서는 CONNECT -> SUBSCRIBE -> SEND 입니다.

포스트맨에서 Websocket request를 하나 만들어줍니다.

`+ws://{domainURL}/ws+` 로 Connect 해줍니다.

====== CONNECT
연결이 되면, 하단의 Message에서 하단의 내용과 같이 입력해준 후 Send합니다.
[source,md,options="nowrap"]
----
CONNECT
accept-version:1.1,1.0
heart-beat:10000,10000

NULL --> NULL이 있어야 정상적으로 연결됩니다. [아래 이미지 참고]

----
image::./images/example_postman.png[]

====== SUBSCRIBE
CONNECT 성공하면 구독을 해줍니다.

구독은 서버로부터 메세지를 받을 수 있도록 해줍니다.
[source,md,options="nowrap"]
----
SUBSCRIBE
id:sub-0 -> 예시입니다. uuid로 생성해서 sub-{uuid} 로 사용하시면 됩니다.
destination:/topic/games/{gameId} 게임 요청 초대해서 받은 gameId를 통해 구독을 진행합니다.

NULL
----

====== SEND
구독도 완료했다면, SEND 요청을 통해 서버와 통신을 진행하시면 됩니다.
[source,md,options="nowrap"]
----
SEND
destination:/app/games/${gameId}/gamer/{memberId} 유저가 가지고있는 memberId를 보내시면 됩니다.

{"command":"START", "data": null}NULL
----

'''
